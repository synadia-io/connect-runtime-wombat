model_version: '1'
kind: source
label: AWS S3
name: aws_s3
icon:
  data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjMxMCIKICAgaGVpZ2h0PSIzMTAiCiAgIHZpZXdCb3g9IjAgMCAzMTAgMzEwIgogICB2ZXJzaW9uPSIxLjEiCiAgIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIgogICBpZD0ic3ZnMjgiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImF3cy1zMy5zdmciCiAgIGlua3NjYXBlOnZlcnNpb249IjEuMSAoMToxLjErMjAyMTA1MjYxNTE3K2NlNjY2M2IzYjcpIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMzMiIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9Im5hbWVkdmlldzMwIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIHdpZHRoPSIzMTBweCIKICAgICBpbmtzY2FwZTp6b29tPSIxLjQ0Njc3NDIiCiAgICAgaW5rc2NhcGU6Y3g9IjQ0LjU4MTk0IgogICAgIGlua3NjYXBlOmN5PSIxOTUuNjA3NTgiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxOTIwIgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwMTYiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjI3IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMjgiIC8+CiAgPGcKICAgICBpZD0iZzI2IgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI3LDAuMjg2KSI+CiAgICA8cGF0aAogICAgICAgZD0iTSAyMC42MjQsNTMuNjg2IDAsNjQgdiAxODEuMDIgbCAyMC42MjQsMTAuMjU0IDAuMTI0LC0wLjE0OSBWIDUzLjgyOCBsIC0wLjEyNCwtMC4xNDIiCiAgICAgICBmaWxsPSIjOGMzMTIzIgogICAgICAgaWQ9InBhdGgyIiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMTMxLDIyOSAyMC42MjQsMjU1LjI3NCBWIDUzLjY4NiBMIDEzMSw3OS4zODcgViAyMjkiCiAgICAgICBmaWxsPSIjZTA1MjQzIgogICAgICAgaWQ9InBhdGg0IiAvPgogICAgPHBhdGgKICAgICAgIGQ9Im0gODEuMTc4LDE4Ny44NjYgNDYuODE4LDUuOTYgMC4yOTQsLTAuNjc4IDAuMjYzLC03Ni43NyAtMC41NTcsLTAuNiAtNDYuODE4LDUuODc0IHYgNjYuMjE0IgogICAgICAgZmlsbD0iIzhjMzEyMyIKICAgICAgIGlkPSJwYXRoNiIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJtIDEyNy45OTYsMjI5LjI5NSAxMDcuMzcxLDI2LjAzNSAwLjE2OSwtMC4yNjkgLTAuMDAzLC0yMDEuMTk1IC0wLjE3LC0wLjE4IC0xMDcuMzY3LDI1Ljk5NiB2IDE0OS42MTMiCiAgICAgICBmaWxsPSIjOGMzMTIzIgogICAgICAgaWQ9InBhdGg4IiAvPgogICAgPHBhdGgKICAgICAgIGQ9Im0gMTc0LjgyNywxODcuODY2IC00Ni44MzEsNS45NiB2IC03OC4wNDggbCA0Ni44MzEsNS44NzQgdiA2Ni4yMTQiCiAgICAgICBmaWxsPSIjZTA1MjQzIgogICAgICAgaWQ9InBhdGgxMCIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJtIDE3NC44MjcsODkuNjMxIC00Ni44MzEsOC41MzUgLTQ2LjgxOCwtOC41MzUgNDYuNzU5LC0xMi4yNTYgNDYuODksMTIuMjU2IgogICAgICAgZmlsbD0iIzVlMWYxOCIKICAgICAgIGlkPSJwYXRoMTIiIC8+CiAgICA8cGF0aAogICAgICAgZD0ibSAxNzQuODI3LDIxOS44MDEgLTQ2LjgzMSwtOC41OTEgLTQ2LjgxOCw4LjU5MSA0Ni43NjEsMTMuMDUzIDQ2Ljg4OCwtMTMuMDUzIgogICAgICAgZmlsbD0iI2YyYjBhOSIKICAgICAgIGlkPSJwYXRoMTQiIC8+CiAgICA8cGF0aAogICAgICAgZD0ibSA4MS4xNzgsODkuNjMxIDQ2LjgxOCwtMTEuNTg2IDAuMzc5LC0wLjExNyBWIDAuMzEzIEwgMTI3Ljk5NiwwIDgxLjE3OCwyMy40MTMgdiA2Ni4yMTgiCiAgICAgICBmaWxsPSIjOGMzMTIzIgogICAgICAgaWQ9InBhdGgxNiIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIDE3NC44MjcsODkuNjMxIDEyNy45OTYsNzguMDQ1IFYgMCBsIDQ2LjgzMSwyMy40MTMgdiA2Ni4yMTgiCiAgICAgICBmaWxsPSIjZTA1MjQzIgogICAgICAgaWQ9InBhdGgxOCIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIDEyNy45OTYsMzA5LjQyOCA4MS4xNzMsMjg2LjAyMyB2IC02Ni4yMTcgbCA0Ni44MjMsMTEuNTgyIDAuNjg5LDAuNzgzIC0wLjE4Nyw3NS45MDYgLTAuNTAyLDEuMzUxIgogICAgICAgZmlsbD0iIzhjMzEyMyIKICAgICAgIGlkPSJwYXRoMjAiIC8+CiAgICA8cGF0aAogICAgICAgZD0ibSAxMjcuOTk2LDMwOS40MjggNDYuODI3LC0yMy40MDUgdiAtNjYuMjE3IGwgLTQ2LjgyNywxMS41ODIgdiA3OC4wNCIKICAgICAgIGZpbGw9IiNlMDUyNDMiCiAgICAgICBpZD0icGF0aDIyIiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gMjM1LjM2Nyw1My42ODYgMjU2LDY0IHYgMTgxLjAyIGwgLTIwLjYzMywxMC4zMSBWIDUzLjY4NiIKICAgICAgIGZpbGw9IiNlMDUyNDMiCiAgICAgICBpZD0icGF0aDI0IiAvPgogIDwvZz4KPC9zdmc+Cg==
status: preview
description: |-
  Downloads objects within an Amazon S3 bucket, optionally filtered by a prefix, either by walking the items in the bucket or by streaming upload notifications in realtime.
fields:
  - path: bucket
    name: bucket
    label: Bucket
    type: string
    optional: true
    description: |-
      The bucket to consume from. If the field `sqs.url` is specified this field is optional.
  - path: prefix
    name: prefix
    label: Prefix
    type: string
    optional: true
    description: |-
      An optional path prefix, if set only objects with the prefix are consumed when walking a bucket.
  - path: region
    name: region
    label: Region
    type: string
    description: |-
      The AWS region to target.
  - path: endpoint
    name: endpoint
    label: Endpoint
    type: string
    optional: true
    description: |-
      Allows you to specify a custom endpoint for the AWS API.
  - path: credentials
    name: credentials
    label: Credentials
    type: object
    description: |-
      Optional manual configuration of AWS credentials to use. More information can be found in [the AWS Guide](https://wombat.dev/pipelines/deploy/cloud/aws/).
    fields:
      - path: credentials.id
        name: id
        label: ID
        type: string
        optional: true
        description: |-
          The ID of credentials to use.
      - path: credentials.secret
        name: secret
        label: Secret
        type: string
        optional: true
        description: |-
          The secret for the credentials being used.
      - path: credentials.token
        name: token
        label: Token
        type: string
        optional: true
        description: |-
          The token for the credentials being used, required when using short term credentials.
  - path: force_path_style_urls
    name: force_path_style_urls
    label: Force Path Style URLs
    type: bool
    default: false
    optional: true
    description: |-
      Forces the client API to use path style URLs for downloading keys, which is often required when connecting to custom endpoints.
  - path: delete_objects
    name: delete_objects
    label: Delete Objects
    type: bool
    default: false
    optional: true
    description: |-
      Whether to delete downloaded objects from the bucket once they are processed.
  - path: scanner
    name: scanner
    label: Scanner
    type: scanner
    description: |-
      The scanner by which the stream of bytes consumed will be broken out into individual messages. Scanners are useful for processing large sources of data without holding the entirety of it within memory. For example, the `csv` scanner allows you to process individual CSV rows without loading the entire CSV file in memory at once.
  - path: sqs
    name: sqs
    label: SQS
    type: object
    description: |-
      Consume SQS messages in order to trigger key downloads.
    fields:
      - path: sqs.url
        name: url
        label: URL
        type: string
        optional: true
        description: |-
          An optional SQS URL to connect to. When specified this queue will control which objects are downloaded.
      - path: sqs.endpoint
        name: endpoint
        label: Endpoint
        type: string
        optional: true
        description: |-
          A custom endpoint to use when connecting to SQS.
      - path: sqs.key_path
        name: key_path
        label: Key Path
        type: string
        default: Records.*.s3.object.key
        optional: true
        description: |-
          A dot path whereby object keys are found in SQS messages.
      - path: sqs.bucket_path
        name: bucket_path
        label: Bucket Path
        type: string
        default: Records.*.s3.bucket.name
        optional: true
        description: |-
          A dot path whereby the bucket name can be found in SQS messages.
      - path: sqs.envelope_path
        name: envelope_path
        label: Envelope Path
        type: string
        optional: true
        examples:
          - Message
        description: |-
          A dot path of a field to extract an enveloped JSON payload for further extracting the key and bucket from SQS messages. This is specifically useful when subscribing an SQS queue to an SNS topic that receives bucket events.
      - path: sqs.delay_period
        name: delay_period
        label: Delay Period
        type: string
        optional: true
        examples:
          - 10s
          - 5m
        description: |-
          An optional period of time to wait from when a notification was originally sent to when the target key download is attempted.
        render_hint: duration
      - path: sqs.max_messages
        name: max_messages
        label: Max Messages
        type: int
        default: 10
        optional: true
        description: |-
          The maximum number of SQS messages to consume from each request.
      - path: sqs.wait_time_seconds
        name: wait_time_seconds
        label: Wait Time Seconds
        type: int
        default: 0
        optional: true
        description: |-
          Whether to set the wait time. Enabling this activates long-polling. Valid values: 0 to 20.
