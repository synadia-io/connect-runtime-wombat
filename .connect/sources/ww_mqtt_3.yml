model_version: '1'
kind: source
label: MQTT 3.1
name: ww_mqtt_3
icon:
  data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgdmlld0JveD0iMCAwIDI4MCAyODAiCiAgIG92ZXJmbG93PSJ2aXNpYmxlIgogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmcxMzgiCiAgIHNvZGlwb2RpOmRvY25hbWU9Im1xdHQuc3ZnIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIxLjIuMiAoYjBhODQ4NjUsIDIwMjItMTItMDEpIgogICB3aWR0aD0iMjgwIgogICBoZWlnaHQ9IjI4MCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzMTQyIiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0ibmFtZWR2aWV3MTQwIgogICAgIHBhZ2Vjb2xvcj0iIzUwNTA1MCIKICAgICBib3JkZXJjb2xvcj0iI2VlZWVlZSIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIGlua3NjYXBlOnNob3dwYWdlc2hhZG93PSIwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIgogICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiCiAgICAgaW5rc2NhcGU6ZGVza2NvbG9yPSIjNTA1MDUwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIwLjM2MjQ4MjQxIgogICAgIGlua3NjYXBlOmN4PSI0NDIuNzgwMTEiCiAgICAgaW5rc2NhcGU6Y3k9IjI2Ni4yMTk4MSIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzMzMiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODgxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIyMDM4IgogICAgIGlua3NjYXBlOndpbmRvdy15PSIxNDAiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmcxMzgiIC8+CiAgPHBhdGgKICAgICBkPSJtIDM4LjYsNTguNiB2IDMxIGggMC42IGMgODQuNCwwIDE1My4yLDY4IDE1My45LDE1MS44IGggMzAuMSBDIDIyMi40LDE0MC43IDE0MCw1OC45IDM4LjYsNTguNiBaIG0gMCw2NCB2IDMxIGggMC42IGMgNDguOSwwIDg4LjgsMzkuMyA4OS41LDg3LjggaCAzMC4xIEMgMTU4LjEsMTc2IDEwNC41LDEyMi45IDM4LjYsMTIyLjYgWiBtIDIwMi44LDM4LjYgViA5OC43IGMgLTcuNywtMTAuNSAtMTcuMiwtMjIuNSAtMjYuNywtMzEuOCAtMTAuNiwtMTAuNSAtMjMsLTIwIC0zNSwtMjguMyBoIC02Ni40IGMgNTguMiwyMC45IDEwNC45LDY1LjggMTI4LjEsMTIyLjYgeiIKICAgICBmaWxsPSIjZmZmZmZmIgogICAgIGlkPSJwYXRoMTM0IiAvPgogIDxwYXRoCiAgICAgZD0ibSAzOS4xNDk5NzgsMTUzLjU1MDAyIGggLTAuNiB2IDc3LjYgYyAwLDUuNiA0LjYsMTAuMiAxMC4yLDEwLjIgaCA3OS45MDAwMDIgYyAtMC43LC00OC41IC00MC41MDAwMDIsLTg3LjggLTg5LjUwMDAwMiwtODcuOCB6IG0gMCwtNjMuOTk5OTk4IGggLTAuNiB2IDMyLjk5OTk5OCBjIDY1LjkwMDAwMiwwLjMgMTE5LjUwMDAwMiw1My4zIDEyMC4yMDAwMDIsMTE4LjggaCAzNC4yIGMgLTAuNiwtODMuOCAtNjkuMywtMTUxLjc5OTk5OCAtMTUzLjgwMDAwMiwtMTUxLjc5OTk5OCB6IE0gMjQxLjQ0OTk4LDIzMS4yNTAwMiB2IC03MC4xIGMgLTIzLjIsLTU2LjggLTY5LjksLTEwMS42OTk5OTggLTEyOCwtMTIyLjU5OTk5OCBIIDQ4Ljc0OTk3OCBjIC01LjYsMCAtMTAuMiw0LjYgLTEwLjIsMTAuMiB2IDkuOSBjIDEwMS40MDAwMDIsMC4zIDE4My45MDAwMDIsODEuOTk5OTk4IDE4NC41MDAwMDIsMTgyLjc5OTk5OCBoIDguMiBjIDUuNywtMC4xIDEwLjIsLTQuNiAxMC4yLC0xMC4yIHogbSAtMjYuNywtMTY0LjM5OTk5OCBjIDkuNCw5LjQgMTksMjEuMyAyNi43LDMxLjggdiAtNTAgYSAxMC4wNywxMC4wNyAwIDAgMCAtMTAuMSwtMTAuMSBoIC01MS41IGMgMTIsOC4zIDI0LjQsMTcuOCAzNC45LDI4LjMgeiIKICAgICBmaWxsPSIjNjYwMDY2IgogICAgIGlkPSJwYXRoMTM2IiAvPgo8L3N2Zz4K
status: preview
description: |+
    Subscribe to topics on MQTT brokers.

    Uses mqtt input component found in [wombatwisdom/components](https://github.com/wombatwisdom/components). It differs from the `mqtt`
    input in that it exposes `enable_auto_ack`, which is set to false by default.

    ## MQTT Version

    This component supports MQTT v3.1.1 protocol. For MQTT v5 support, use ww_mqtt_5 (coming soon).

    ## Delivery guarantees

    By default, this input disables auto acknowledgment to ensure at-least-once delivery semantics.

    If message loss is acceptable, you can set `enable_auto_ack: true` to enable at-most-once delivery.

    ### Example: At least once

    ```yaml
    input:
      ww_mqtt_3:
        urls:
          - tcp://localhost:1883
        filters:
          sensor/+/data: 1
        clean_session: false
        enable_auto_ack: false # Ack will happen once output is done processing.
    ```

    ### Example: at most once

    ```yaml
    input:
      ww_mqtt_3:
        urls:
          - tcp://localhost:1883
        filters:
          metrics/#: 0
        clean_session: true
        enable_auto_ack: true # Ack will happen once input receives message
    ```

fields:
    - path: urls
      name: urls
      label: urls
      kind: list
      type: string
      default: ["tcp://localhost:1883"]
      description: List of MQTT broker URLs to connect to.
    - path: client_id
      name: client_id
      label: client_id
      kind: scalar
      type: string
      default: ""
      description: Unique client identifier. If empty, one will be generated.
    - path: filters
      name: filters
      label: filters
      kind: scalar
      type: object
      optional: true
      description: Map of topic patterns to QoS levels to subscribe to.
    - path: clean_session
      name: clean_session
      label: clean_session
      kind: scalar
      type: bool
      default: true
      description: Start with a clean session
    - path: connect_timeout
      name: connect_timeout
      label: connect_timeout
      kind: scalar
      type: string
      default: "30s"
      description: Connection timeout
    - path: keepalive
      name: keepalive
      label: keepalive
      kind: scalar
      type: string
      default: "60s"
      description: Keep alive interval
    - path: auth
      name: auth
      label: auth
      kind: scalar
      type: object
      optional: true
      description: Authentication configuration
      fields:
        - path: auth.username
          name: username
          label: username
          kind: scalar
          type: string
          default: ""
          description: Username for authentication
        - path: auth.password
          name: password
          label: password
          kind: scalar
          type: string
          default: ""
          description: Password for authentication
    - path: tls
      name: tls
      label: TLS
      kind: scalar
      type: object
      default: {}
      optional: true
      description: |-
        TLS configuration for secure connections
      fields:
        - path: tls.enabled
          name: enabled
          label: Enabled
          kind: scalar
          type: bool
          default: false
          optional: true
          description: |-
            Whether custom TLS settings are enabled.
        - path: tls.skip_cert_verify
          name: skip_cert_verify
          label: Skip Cert Verify
          kind: scalar
          type: bool
          default: false
          optional: true
          description: |-
            Whether to skip server side certificate verification.
        - path: tls.enable_renegotiation
          name: enable_renegotiation
          label: Enable Renegotiation
          kind: scalar
          type: bool
          default: false
          optional: true
          description: |-
            Whether to allow the remote server to repeatedly request renegotiation. Enable this option if you're seeing the error message `local error: tls: no renegotiation`.
        - path: tls.root_cas
          name: root_cas
          label: Root Cas
          kind: scalar
          type: string
          default: ""
          optional: true
          examples:
            - |-
              -----BEGIN CERTIFICATE-----
              ...
              -----END CERTIFICATE-----
          description: |-
            An optional root certificate authority to use. This is a string, representing a certificate chain from the parent trusted root certificate, to possible intermediate signing certificates, to the host certificate.
          secret: true
        - path: tls.root_cas_file
          name: root_cas_file
          label: Root Cas File
          kind: scalar
          type: string
          default: ""
          optional: true
          examples:
            - ./root_cas.pem
          description: |-
            An optional path of a root certificate authority file to use. This is a file, often with a .pem extension, containing a certificate chain from the parent trusted root certificate, to possible intermediate signing certificates, to the host certificate.
        - path: tls.client_certs
          name: client_certs
          label: Client Certs
          kind: list
          type: object
          default: []
          optional: true
          examples:
            - - cert: foo
                key: bar
            - - cert_file: ./example.pem
                key_file: ./example.key
          description: |-
            A list of client certificates to use. For each certificate either the fields `cert` and `key`, or `cert_file` and `key_file` should be specified, but not both.
          fields:
            - path: tls.client_certs[].cert
              name: cert
              label: Cert
              kind: scalar
              type: string
              default: ""
              optional: true
              description: |-
                A plain text certificate to use.
            - path: tls.client_certs[].key
              name: key
              label: Key
              kind: scalar
              type: string
              default: ""
              optional: true
              description: |-
                A plain text certificate key to use.
              secret: true
            - path: tls.client_certs[].cert_file
              name: cert_file
              label: Cert File
              kind: scalar
              type: string
              default: ""
              optional: true
              description: |-
                The path of a certificate to use.
            - path: tls.client_certs[].key_file
              name: key_file
              label: Key File
              kind: scalar
              type: string
              default: ""
              optional: true
              description: |-
                The path of a certificate key to use.
            - path: tls.client_certs[].password
              name: password
              label: Password
              kind: scalar
              type: string
              default: ""
              optional: true
              examples:
                - foo
                - ${KEY_PASSWORD}
              description: |-
                A plain text password for when the private key is password encrypted in PKCS#1 or PKCS#8 format. The obsolete `pbeWithMD5AndDES-CBC` algorithm is not supported for the PKCS#8 format.

                Because the obsolete pbeWithMD5AndDES-CBC algorithm does not authenticate the ciphertext, it is vulnerable to padding oracle attacks that can let an attacker recover the plaintext.
              secret: true
    - path: will
      name: will
      label: Will
      kind: scalar
      type: object
      default: {
        topic: ""
      }
      description: |-
        Last Will and Testament configuration
      fields:
        - path: will.topic
          name: topic
          label: Topic
          kind: scalar
          type: string
          description: |-
            Topic for will message
        - path: will.payload
          name: payload
          label: Payload
          kind: scalar
          type: string
          default: ""
          description: |-
            Payload for will message
        - path: will.qos
          name: qos
          label: QoS
          kind: scalar
          type: int
          default: 0
          description: |-
            QoS level for will message (0, 1, or 2)
        - path: will.retained
          name: retained
          label: Retained
          kind: scalar
          type: bool
          default: false
          description: |-
            Retained flag for will message
    - path: enable_auto_ack
      name: enable_auto_ack
      label: enable_auto_ack
      kind: scalar
      type: bool
      default: false
      optional: true
      description: Enable automatic acknowledgment (paho SetAutoAckDisabled). When false (default), messages are ACK'd after processing (at-least-once). When true, messages are ACK'd immediately (at-most-once with higher throughput but message loss risk).
