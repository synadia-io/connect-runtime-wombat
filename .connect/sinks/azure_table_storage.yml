model_version: "1"
name: azure_table_storage
label: Azure Table Storage
kind: sink
status: stable
description: >-
  Stores messages in an Azure Table Storage table.

fields:
  - path: storage_account
    name: storage_account
    label: Storage Account
    type: string
    optional: true
    description: >-
      The name of the Azure Storage Account. This field is ignored if `storage_connection_string` is set.

  - path: storage_access_key
    name: storage_access_key
    label: Storage Access Key
    type: string
    optional: true
    description: >-
      The key for the Azure Storage Account. This field is ignored if `storage_connection_string` is set.

  - path: storage_sas_token
    name: storage_sas_token
    label: Storage SAS Token
    type: string
    optional: true
    description: >-
      The SAS token for the Azure Storage Account. This field is ignored if `storage_connection_string` or 
      `storage_access_key` are set.

  - path: storage_connection_string
    name: storage_connection_string
    label: Storage Connection String
    type: string
    optional: true
    description: >-
      The connection string for the Azure Storage Account. If this field is set, `storage_account`, 
      `storage_sas_token` and `storage_access_key` are ignored.

  - path: table_name
    name: table_name
    label: Table
    type: string
    description: >-
        The name of the table to store messages in.
    examples:
      - ${! meta("kafka_topic") }
      - ${! json("table") }

  - path: partition_key
    name: partition_key
    label: Partition Key
    type: string
    optional: true
    default: ""
    description: >-
      The partition key to use when storing messages in the table.

  - path: row_key
    name: row_key
    label: Row Key
    type: string
    optional: true
    default: ""
    description: >-
      The row key to use when storing messages in the table.

  - path: properties
    name: properties
    label: Properties
    type: object
    default: {}
    optional: true
    description: >-
      A map of properties to set on the table entity. The key is the property name and the value is the property value.

  - path: transaction_type
    name: transaction_type
    label: Transaction Type
    type: string
    optional: true
    default: "INSERT"
    description: >-
      The type of transaction to use when writing to the table. This field supports interpolation functions.
    constraints:
      - enum:
          - INSERT
          - INSERT_MERGE
          - INSERT_REPLACE
          - UPDATE_MERGE
          - UPDATE_REPLACE
          - DELETE

  - path: max_in_flight
    name: max_in_flight
    label: Max In Flight
    type: int
    optional: true
    default: 64
    description: >-
      The maximum number of messages to have in flight at any given time.

  - path: timeout
    name: timeout
    label: Timeout
    type: string
    optional: true
    default: "5s"
    description: >-
      The maximum period to wait on an upload before abandoning it and reattempting.

  - path: batching
    name: batching
    label: Batching
    type: object
    description: >-
      Allows you to configure a batching policy.
    examples:
      - byte_size: 5000
        count: 0
        period: 1s
      - count: 10
        period: 1s
      - check: this.contains("END BATCH")
        count: 0
        period: 1m
    fields:
      - path: batching.count
        name: count
        label: Count
        type: int
        description: >-
          A number of messages at which the batch should be flushed. If `0`
          disables count based batching.
      - path: batching.byte_size
        name: byte_size
        label: Byte Size
        type: int
        description: >-
          An amount of bytes at which the batch should be flushed. If `0` disables
          size based batching.
      - path: batching.period
        name: period
        label: Period
        type: string
        render_hint: duration
        description: >-
          A period in which an incomplete batch should be flushed regardless
          of its size.
        examples:
          - "1s"
          - "1m"
          - "500ms"
      - path: batching.check
        name: check
        label: Check
        type: condition
        description: >-
          A Bloblang query that should return a boolean value indicating whether a message should end a batch.
        examples:
          - this.type == "end_of_transaction"
