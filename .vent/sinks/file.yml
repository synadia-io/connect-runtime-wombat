model_version: "1"
name: file
label: File
kind: sink
status: stable
description: >-
  Writes messages to files on disk based on a chosen codec.
  
  Messages can be written to different files by using interpolation functions in the path field. However, only one 
  file is ever open at a given time, and therefore when the path changes the previously open file is closed.
  
  A codec determines how messages are written to the file.

fields:
  - path: path
    name: path
    label: Path
    type: expression
    description: >-
      The path to the file to write to. If the path contains interpolation functions, the file will be rotated when the 
      value of the interpolation function changes.
    examples:
      - /var/log/messages
      - /var/log/${!@path}
      - /var/log/${!@path}.log
      - /tmp/${! json("document.id") }.json

  - path: codec
    name: codec
    label: Codec
    type: string
    description: >-
      The codec to use when writing messages to the file. The codec can be one of the following:
      
        - `all-bytes`: Writes each message to a file in full, if the file already exists the old content is deleted.
        - `append`: Append each message to the output stream without any delimiter or special encoding.
        - `lines`: Append each message to the output stream followed by a line break.
        - `delim:x`: Append each message to the output stream followed by a delimiter `x`.
    default: lines
    optional: true
    constraints:
      - enum: ["all-bytes", "append", "lines", "delim:x"]
    examples:
      - "lines"
      - "delim:\t"
      - "delim:foobar"